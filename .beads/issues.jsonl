{"id":"robothector-2wg","title":"Phase 3: Client/Server with Video Streaming","description":"Core deliverable: Pi WebSocket server for arcade-drive tank control + MJPEG video stream. Steam Deck pygame client with joystick input and camera display.","status":"open","priority":1,"issue_type":"epic","owner":"cyrille.cailac@gmail.com","created_at":"2026-02-18T13:08:57.36729861+08:00","created_by":"cyrille","updated_at":"2026-02-18T13:08:57.36729861+08:00","labels":["client-server","core","phase-3"]}
{"id":"robothector-2wg.1","title":"Build WebSocket control server","description":"Create server/control.py — asyncio WebSocket server for robot control.\n\nPROTOCOL: see docs/protocol.md\n- Client sends: {type:'drive', axis_x, axis_y} at ~20Hz, {type:'mode', mode}, {type:'ping'}\n- Server sends: {type:'state', mode, connected} at ~5Hz, {type:'pong'}, {type:'error', message}\n\nIMPLEMENTATION:\n- Use 'websockets' library (installed in .venv), asyncio event loop\n- Listen on port 8765, accept ONE client (reject additional with error message)\n- On 'drive' message: call motors.arcade_mix(axis_x, axis_y) then motors.set_motors(left, right)\n- On 'mode' message: call sirens.play_siren(mode)\n- Dead-man's switch: track last_message_time. asyncio task checks every 100ms, calls motors.stop() if \u003e500ms stale. See robothector-2wg.3 for full spec.\n- On client disconnect: motors.stop(), sirens.stop_sirens()\n- Send state message every 200ms (5Hz)\n\nEXISTING CODE TO USE:\n- server/motors.py — arcade_mix(axis_x, axis_y), set_motors(left, right), stop(), init(), cleanup()\n- server/sirens.py — play_siren(mode), stop_sirens(), init(), cleanup()\n\nRun: uv run python -c 'from server.control import ControlServer; ...' (or via server/main.py)","status":"closed","priority":0,"issue_type":"task","owner":"cyrille.cailac@gmail.com","created_at":"2026-02-18T13:08:57.398419829+08:00","created_by":"cyrille","updated_at":"2026-02-19T12:21:54.280272715+08:00","closed_at":"2026-02-19T12:21:54.280272715+08:00","close_reason":"Built server/control.py: WebSocket server with drive/mode/ping dispatch, single-client, 5Hz state broadcast.","labels":["server","websocket"],"dependencies":[{"issue_id":"robothector-2wg.1","depends_on_id":"robothector-2wg","type":"parent-child","created_at":"2026-02-18T13:08:57.399597308+08:00","created_by":"cyrille"},{"issue_id":"robothector-2wg.1","depends_on_id":"robothector-cgc.2","type":"blocks","created_at":"2026-02-18T13:08:57.763605753+08:00","created_by":"cyrille"},{"issue_id":"robothector-2wg.1","depends_on_id":"robothector-cgc.3","type":"blocks","created_at":"2026-02-18T13:08:57.792500731+08:00","created_by":"cyrille"},{"issue_id":"robothector-2wg.1","depends_on_id":"robothector-cgc.4","type":"blocks","created_at":"2026-02-18T13:08:57.822500089+08:00","created_by":"cyrille"}]}
{"id":"robothector-2wg.10","title":"Add configuration file support","description":"Create config.yaml and loader modules for server and client.\n\nSERVER CONFIG (server/config.py, loads config.yaml):\n  gpio:\n    in1: 26\n    in2: 19\n    in3: 13\n    in4: 6\n  ws_port: 8765\n  video_port: 5000\n  camera_resolution: [640, 480]\n  deadman_timeout_ms: 500\n  discovery_port: 5555\n\nCLIENT CONFIG (client/config.py, loads config.yaml):\n  server_host: robothector.local\n  ws_port: 8765\n  video_port: 5000\n  display_resolution: [1280, 800]\n  fullscreen: true\n  joystick_deadzone: 0.1\n\nOverride any value with env var: ROBOTHECTOR_WS_PORT=9000 etc.\nUse PyYAML or tomllib (stdlib in 3.11+) for parsing.","status":"open","priority":2,"issue_type":"task","owner":"cyrille.cailac@gmail.com","created_at":"2026-02-18T13:08:57.69980565+08:00","created_by":"cyrille","updated_at":"2026-02-19T11:59:17.313380377+08:00","labels":["client","config","server"],"dependencies":[{"issue_id":"robothector-2wg.10","depends_on_id":"robothector-2wg","type":"parent-child","created_at":"2026-02-18T13:08:57.70087133+08:00","created_by":"cyrille"}]}
{"id":"robothector-2wg.11","title":"End-to-end integration test","description":"End-to-end integration test with real hardware.\n\nSETUP:\n  Pi: ssh robothector 'cd ~/robothector \u0026\u0026 git pull \u0026\u0026 uv run python -m server.main'\n  Desktop: uv run python -m client.main\n\nTEST CHECKLIST:\n  [ ] Client discovers server (via mDNS or UDP beacon)\n  [ ] Video stream displays in pygame window (640x480, \u003e10 FPS)\n  [ ] Joystick forward/backward drives both motors\n  [ ] Joystick left/right creates differential steering (arcade mix)\n  [ ] L1 button triggers firefighter siren on Pi speaker\n  [ ] R1 button triggers ambulance siren on Pi speaker\n  [ ] Disconnect client → motors stop within 500ms (dead-man's switch)\n  [ ] Reconnect client → control resumes automatically\n  [ ] Server restart → client auto-reconnects within ~2s\n  [ ] systemd: sudo systemctl restart robothector → client reconnects\n\nMEASURE:\n  - Video latency (visual: point camera at stopwatch)\n  - Control latency (joystick to motor response)\n  - CPU usage on Pi: ssh robothector 'top -bn1 | head -20'\n\nREQUIRES: H-bridge physically connected to Pi and motors. Camera mounted.","status":"open","priority":1,"issue_type":"task","owner":"cyrille.cailac@gmail.com","created_at":"2026-02-18T13:08:57.733429026+08:00","created_by":"cyrille","updated_at":"2026-02-19T12:00:17.823149787+08:00","labels":["integration","testing"],"dependencies":[{"issue_id":"robothector-2wg.11","depends_on_id":"robothector-2wg","type":"parent-child","created_at":"2026-02-18T13:08:57.734468897+08:00","created_by":"cyrille"},{"issue_id":"robothector-2wg.11","depends_on_id":"robothector-do6.5","type":"blocks","created_at":"2026-02-18T13:08:57.952986421+08:00","created_by":"cyrille"},{"issue_id":"robothector-2wg.11","depends_on_id":"robothector-cv2.3","type":"blocks","created_at":"2026-02-18T13:08:57.982856961+08:00","created_by":"cyrille"},{"issue_id":"robothector-2wg.11","depends_on_id":"robothector-2wg.4","type":"blocks","created_at":"2026-02-18T13:08:58.234880951+08:00","created_by":"cyrille"},{"issue_id":"robothector-2wg.11","depends_on_id":"robothector-2wg.8","type":"blocks","created_at":"2026-02-18T13:08:58.266127661+08:00","created_by":"cyrille"}]}
{"id":"robothector-2wg.2","title":"Integrate MJPEG camera into server","description":"Create server/camera.py — MJPEG streaming from Pi Camera Module 3 (IMX708).\n\nREFERENCE: The deleted webapp/app.py used Flask + Picamera2 + JpegEncoder + StreamingOutput pattern. That code is in git history (commit 7797b15) if needed.\n\nIMPLEMENTATION:\n- CameraServer class with start(port=5000)/stop() interface\n- Flask app with two routes:\n  - GET /video_feed — multipart/x-mixed-replace MJPEG stream (continuous JPEG frames)\n  - GET /health — returns 200 OK with JSON {status:'ok', resolution:[w,h]}\n- Use Picamera2 with create_video_configuration(main={'size': (640, 480)})\n- JpegEncoder encodes frames, StreamingOutput (io.BufferedIOBase subclass) buffers latest frame\n- Flask runs in a daemon thread so it doesn't block the main asyncio loop\n- Graceful start/stop: cam.stop_recording() + cam.close() on shutdown\n\nCAMERA VERIFIED: ssh robothector 'libcamera-hello --list-cameras' shows IMX708. Picamera2 API tested and working (see closed task robothector-cv2.2).\n\nDeps: flask, picamera2 (both available on Pi). On desktop without a camera, start() should log a warning and serve a static 'no camera' placeholder frame.","status":"closed","priority":0,"issue_type":"task","owner":"cyrille.cailac@gmail.com","created_at":"2026-02-18T13:08:57.432372683+08:00","created_by":"cyrille","updated_at":"2026-02-19T12:21:54.356320335+08:00","closed_at":"2026-02-19T12:21:54.356320335+08:00","close_reason":"Built server/camera.py: MJPEG streaming via Flask, picamera2 integration, placeholder fallback.","labels":["camera","server","streaming"],"dependencies":[{"issue_id":"robothector-2wg.2","depends_on_id":"robothector-2wg","type":"parent-child","created_at":"2026-02-18T13:08:57.433524623+08:00","created_by":"cyrille"},{"issue_id":"robothector-2wg.2","depends_on_id":"robothector-cv2.2","type":"blocks","created_at":"2026-02-18T13:08:57.859210129+08:00","created_by":"cyrille"}]}
{"id":"robothector-2wg.3","title":"Implement dead-man's switch safety mechanism","description":"Implement dead-man's switch in server/control.py (part of the WebSocket server, task robothector-2wg.1).\n\nSPEC (from docs/protocol.md):\n- Track last_message_time = time.monotonic() on every received message\n- Watchdog asyncio task runs every 100ms:\n  - If now - last_message_time \u003e 0.5s: call motors.stop(), log warning\n  - If now - last_message_time \u003e 5.0s: log 'SAFE MODE', set a safe_mode flag\n- On client disconnect (WebSocket close): immediately call motors.stop() and sirens.stop_sirens()\n- On server startup: motors start stopped (motors.init() already does this)\n- On server shutdown (SIGTERM): motors.stop(), motors.cleanup()\n\nCRITICAL: This must be implemented BEFORE any real driving tests. motors.stop() must NEVER raise — wrap in try/except.\n\nThis task is logically part of robothector-2wg.1 (control server) but called out separately for safety visibility.","status":"closed","priority":0,"issue_type":"task","owner":"cyrille.cailac@gmail.com","created_at":"2026-02-18T13:08:57.466054419+08:00","created_by":"cyrille","updated_at":"2026-02-19T12:21:54.319109747+08:00","closed_at":"2026-02-19T12:21:54.319109747+08:00","close_reason":"Dead-man's switch implemented in control.py: 500ms motor stop, 5s safe mode, disconnect cleanup.","labels":["safety","server"],"dependencies":[{"issue_id":"robothector-2wg.3","depends_on_id":"robothector-2wg","type":"parent-child","created_at":"2026-02-18T13:08:57.467118809+08:00","created_by":"cyrille"}]}
{"id":"robothector-2wg.4","title":"Build server main entry point","description":"Create server/main.py — unified entry point that starts all server components.\n\nCOMPONENTS TO START:\n1. server.motors.init() — GPIO setup (BCM pins 26/19/13/6)\n2. server.sirens.init() — pygame.mixer for WAV playback\n3. server.camera.CameraServer().start(port=5000) — Flask MJPEG in daemon thread\n4. server.discovery beacon thread (port 5555) — from server/discovery.py\n5. server.control.ControlServer (port 8765) — asyncio WebSocket (runs the event loop)\n\nCLI ARGS (argparse):\n  --ws-port 8765      WebSocket control port\n  --video-port 5000   MJPEG video port\n  --no-camera         Skip camera (for dev/testing without Pi camera)\n  --no-motors         Skip GPIO init (for dev/testing without H-bridge)\n\nSIGNAL HANDLING:\n  SIGTERM/SIGINT → motors.stop(), motors.cleanup(), camera.stop(), sirens.cleanup(), sys.exit(0)\n\nSTARTUP LOG: print IP address, ports, hardware status (camera found/not, GPIO available/stub)\n\nRUN: uv run python -m server.main (or: python3 -m server.main on Pi)\nAdd server/__main__.py that imports and calls main() for -m support.","status":"closed","priority":0,"issue_type":"task","owner":"cyrille.cailac@gmail.com","created_at":"2026-02-18T13:08:57.500740166+08:00","created_by":"cyrille","updated_at":"2026-02-19T12:21:54.393934754+08:00","closed_at":"2026-02-19T12:21:54.393934754+08:00","close_reason":"Built server/main.py + __main__.py: unified entry point with --no-camera/--no-motors flags, signal handling.","labels":["main","server"],"dependencies":[{"issue_id":"robothector-2wg.4","depends_on_id":"robothector-2wg","type":"parent-child","created_at":"2026-02-18T13:08:57.501715528+08:00","created_by":"cyrille"},{"issue_id":"robothector-2wg.4","depends_on_id":"robothector-cgc.1","type":"blocks","created_at":"2026-02-18T13:08:57.890340138+08:00","created_by":"cyrille"},{"issue_id":"robothector-2wg.4","depends_on_id":"robothector-2wg.1","type":"blocks","created_at":"2026-02-18T13:08:58.019573922+08:00","created_by":"cyrille"},{"issue_id":"robothector-2wg.4","depends_on_id":"robothector-2wg.2","type":"blocks","created_at":"2026-02-18T13:08:58.048033316+08:00","created_by":"cyrille"},{"issue_id":"robothector-2wg.4","depends_on_id":"robothector-2wg.3","type":"blocks","created_at":"2026-02-18T13:08:58.077944137+08:00","created_by":"cyrille"}]}
{"id":"robothector-2wg.5","title":"Build client joystick input handler","description":"Create client/joystick.py — gamepad input handler for desktop prototype.\n\nINTERFACE:\n  get_input() -\u003e dict with keys:\n    - axis_x: float (-1.0 left to 1.0 right) — left stick X\n    - axis_y: float (-1.0 forward to 1.0 backward) — left stick Y\n    - mode: str ('firefighter', 'ambulance', or '') — toggled by buttons\n  init() — call pygame.joystick.init(), open first joystick\n  cleanup() — pygame.joystick.quit()\n\nAXIS MAPPING (standard SDL gamepad):\n  - Axis 0 = left stick X (steering)\n  - Axis 1 = left stick Y (throttle)\n  - Button 4 = L1 → toggle firefighter mode\n  - Button 5 = R1 → toggle ambulance mode\n\nDEADZONE: ignore axis values between -0.1 and 0.1 (snap to 0)\n\nNOTES:\n  - On Steam Deck in gaming mode, built-in controls appear as standard SDL gamepad (see docs/steamdeck-env.md)\n  - For desktop testing, any USB/BT gamepad works\n  - If no joystick connected, return neutral values (0,0,'') and log warning\n  - Mode is a toggle: press L1 once = firefighter on, press again = off","status":"closed","priority":1,"issue_type":"task","owner":"cyrille.cailac@gmail.com","created_at":"2026-02-18T13:08:57.533028785+08:00","created_by":"cyrille","updated_at":"2026-02-19T12:23:46.024455952+08:00","closed_at":"2026-02-19T12:23:46.024455952+08:00","close_reason":"Built client/joystick.py: SDL gamepad input with deadzone, L1/R1 mode toggles.","labels":["client","joystick","steamdeck"],"dependencies":[{"issue_id":"robothector-2wg.5","depends_on_id":"robothector-2wg","type":"parent-child","created_at":"2026-02-18T13:08:57.534102615+08:00","created_by":"cyrille"}]}
{"id":"robothector-2wg.6","title":"Build client WebSocket sender/receiver","description":"Create client/network.py — WebSocket client that sends commands and receives state.\n\nPROTOCOL: see docs/protocol.md\n\nINTERFACE:\n  class NetworkClient:\n    __init__(host='robothector.local', ws_port=8765)\n    start() — spawn background thread, connect WebSocket\n    stop() — close connection, join thread\n    send_drive(axis_x, axis_y) — queue a drive message\n    send_mode(mode) — queue a mode message\n    get_state() -\u003e dict or None — latest state from server\n    is_connected() -\u003e bool\n\nIMPLEMENTATION:\n- Background thread runs a send/receive loop\n- Send queue (thread-safe collections.deque or queue.Queue): main loop pushes, bg thread pops and sends\n- Receive: parse JSON state messages, store latest in a thread-safe variable\n- Auto-reconnect: on disconnect, retry every 2s, log attempts\n- Discovery fallback: if WebSocket connect fails, try client.discovery.discover() to find IP\n\nDEPS: websocket-client (installed in .venv). Use websocket.WebSocket (synchronous API) in the bg thread — simpler than async for a threaded pygame app.","status":"closed","priority":1,"issue_type":"task","owner":"cyrille.cailac@gmail.com","created_at":"2026-02-18T13:08:57.565735849+08:00","created_by":"cyrille","updated_at":"2026-02-19T12:23:46.063818736+08:00","closed_at":"2026-02-19T12:23:46.063818736+08:00","close_reason":"Built client/network.py: threaded WebSocket client with auto-reconnect and discovery fallback.","labels":["client","websocket"],"dependencies":[{"issue_id":"robothector-2wg.6","depends_on_id":"robothector-2wg","type":"parent-child","created_at":"2026-02-18T13:08:57.56679252+08:00","created_by":"cyrille"},{"issue_id":"robothector-2wg.6","depends_on_id":"robothector-do6.2","type":"blocks","created_at":"2026-02-18T13:08:57.921450876+08:00","created_by":"cyrille"}]}
{"id":"robothector-2wg.7","title":"Build client MJPEG video display","description":"Create client/video.py — MJPEG stream receiver and pygame surface decoder.\n\nINTERFACE:\n  class VideoStream:\n    __init__(host='robothector.local', video_port=5000)\n    start() — spawn background thread, connect to MJPEG stream\n    stop() — close connection, join thread\n    get_frame() -\u003e pygame.Surface or None — latest decoded frame\n    is_connected() -\u003e bool\n\nIMPLEMENTATION:\n- Background thread connects to http://\u003chost\u003e:\u003cport\u003e/video_feed\n- Use urllib.request.urlopen with stream, read multipart/x-mixed-replace boundaries\n- Parse boundary: read until '--frame\\r\\n', then Content-Type header, then JPEG bytes until next boundary\n- Decode JPEG to pygame.Surface: write bytes to io.BytesIO, then pygame.image.load(bio, 'frame.jpg')\n- Store latest surface in a thread-safe variable (threading.Lock around surface reference swap)\n- On connection loss: set is_connected=False, retry every 2s\n- If no frame yet or disconnected: get_frame() returns None (caller shows 'No Signal' placeholder)\n\nTARGET: 640x480 JPEG frames at 15-30 FPS. Decoding should be \u003c10ms per frame on desktop.","status":"closed","priority":1,"issue_type":"task","owner":"cyrille.cailac@gmail.com","created_at":"2026-02-18T13:08:57.598028468+08:00","created_by":"cyrille","updated_at":"2026-02-19T12:23:46.103200211+08:00","closed_at":"2026-02-19T12:23:46.103200211+08:00","close_reason":"Built client/video.py: MJPEG stream reader with JPEG marker parsing into pygame Surfaces.","labels":["client","pygame","video"],"dependencies":[{"issue_id":"robothector-2wg.7","depends_on_id":"robothector-2wg","type":"parent-child","created_at":"2026-02-18T13:08:57.599170878+08:00","created_by":"cyrille"}]}
{"id":"robothector-2wg.8","title":"Build client main loop and HUD","description":"Create client/main.py and client/ui.py — pygame main loop with HUD overlay.\n\nDISPLAY: 1280x800 (Steam Deck native, also works on desktop). Fullscreen by default, F11 to toggle.\n\nMAIN LOOP (client/main.py, 30 FPS):\n  1. joystick.get_input() -\u003e axis_x, axis_y, mode\n  2. network.send_drive(axis_x, axis_y) + send_mode(mode) if changed\n  3. frame = video.get_frame()\n  4. ui.render(screen, frame, state=network.get_state(), input={axis_x, axis_y, mode}, connected=network.is_connected())\n  5. pygame.display.flip(), clock.tick(30)\n\nSTARTUP: init pygame display, then joystick.init(), network.start(), video.start()\nSHUTDOWN (Escape or window close): network.send_drive(0,0), network.stop(), video.stop(), joystick.cleanup()\n\nUI LAYOUT (client/ui.py):\n  - Camera feed: centered, scaled to fit (maintain aspect ratio of 640x480 within 1280x800)\n  - If no frame: dark grey background with 'No Signal' text\n  - Top-left overlay: connection status (green dot = connected, red = disconnected), latency\n  - Top-right: current mode ('FIREFIGHTER' in red, 'AMBULANCE' in blue, or nothing)\n  - Bottom-center: mini joystick indicator (small circle showing stick position)\n\nCOMPONENTS TO IMPORT:\n  - client.joystick (get_input, init, cleanup)\n  - client.network (NetworkClient)\n  - client.video (VideoStream)\n\nAdd client/__main__.py for 'uv run python -m client.main' support.","status":"closed","priority":1,"issue_type":"task","owner":"cyrille.cailac@gmail.com","created_at":"2026-02-18T13:08:57.631770653+08:00","created_by":"cyrille","updated_at":"2026-02-19T12:23:46.147743587+08:00","closed_at":"2026-02-19T12:23:46.147743587+08:00","close_reason":"Built client/main.py, ui.py, __main__.py: 30fps main loop, HUD with connection status, mode, joystick indicator.","labels":["client","pygame","ui"],"dependencies":[{"issue_id":"robothector-2wg.8","depends_on_id":"robothector-2wg","type":"parent-child","created_at":"2026-02-18T13:08:57.632973983+08:00","created_by":"cyrille"},{"issue_id":"robothector-2wg.8","depends_on_id":"robothector-2wg.5","type":"blocks","created_at":"2026-02-18T13:08:58.138132667+08:00","created_by":"cyrille"},{"issue_id":"robothector-2wg.8","depends_on_id":"robothector-2wg.6","type":"blocks","created_at":"2026-02-18T13:08:58.168127948+08:00","created_by":"cyrille"},{"issue_id":"robothector-2wg.8","depends_on_id":"robothector-2wg.7","type":"blocks","created_at":"2026-02-18T13:08:58.204167387+08:00","created_by":"cyrille"}]}
{"id":"robothector-2wg.9","title":"Create systemd service for Pi server","description":"Create robothector.service systemd unit file and install script.\n\nUNIT FILE (robothector.service):\n  [Unit]\n  Description=Robothector Robot Server\n  After=network-online.target\n  Wants=network-online.target\n\n  [Service]\n  Type=simple\n  User=robothector\n  WorkingDirectory=/home/robothector/robothector\n  ExecStart=/home/robothector/.local/bin/uv run python -m server.main\n  Restart=on-failure\n  RestartSec=5\n  Environment=PYTHONUNBUFFERED=1\n\n  [Install]\n  WantedBy=multi-user.target\n\nINSTALL SCRIPT (scripts/install-service.sh):\n  sudo cp robothector.service /etc/systemd/system/\n  sudo systemctl daemon-reload\n  sudo systemctl enable robothector\n  sudo systemctl start robothector\n\nNOTE: User is 'robothector' (not root). GPIO access requires the user to be in the 'gpio' group — verify with: ssh robothector 'groups' and 'sudo usermod -aG gpio robothector' if needed. uv is at /home/robothector/.local/bin/uv (installed during Phase 0).\n\nVERIFY: sudo systemctl status robothector shows active. Survives reboot. Client can connect to ws://\u003cip\u003e:8765 and http://\u003cip\u003e:5000/video_feed.","status":"closed","priority":1,"issue_type":"task","owner":"cyrille.cailac@gmail.com","created_at":"2026-02-18T13:08:57.665829846+08:00","created_by":"cyrille","updated_at":"2026-02-19T12:24:15.586261307+08:00","closed_at":"2026-02-19T12:24:15.586261307+08:00","close_reason":"Created robothector.service and scripts/install-service.sh with gpio group check.","labels":["deployment","pi","systemd"],"dependencies":[{"issue_id":"robothector-2wg.9","depends_on_id":"robothector-2wg","type":"parent-child","created_at":"2026-02-18T13:08:57.667197304+08:00","created_by":"cyrille"},{"issue_id":"robothector-2wg.9","depends_on_id":"robothector-2wg.4","type":"blocks","created_at":"2026-02-18T13:08:58.107802339+08:00","created_by":"cyrille"}]}
{"id":"robothector-8gv","title":"Update protocol.md with audio WebSocket messages","description":"Add audio control messages to docs/protocol.md.\n\nNEW MESSAGES:\n- {\"type\": \"audio_start\"} — client→server, requests Pi mic audio stream start\n- {\"type\": \"audio_stop\"} — client→server, requests Pi to stop audio streaming\n- {\"type\": \"ptt\", \"active\": true/false} — client→server, push-to-talk state\n\nNEW UDP PORTS:\n- UDP 5556: Pi→Client audio (robot environment mic)\n- UDP 5557: Client→Pi audio (operator voice)\n\nPACKET FORMAT:\n- [seq:uint16][audio:1280 bytes int16 PCM] = 1282 bytes total\n- 16kHz mono, 640 samples per packet (40ms)\n- Sequence number wraps at 65535","status":"open","priority":3,"issue_type":"task","owner":"cyrille.cailac@gmail.com","created_at":"2026-02-22T00:21:19.063192274+08:00","created_by":"cyrille","updated_at":"2026-02-22T00:21:19.063192274+08:00","labels":["audio"],"dependencies":[{"issue_id":"robothector-8gv","depends_on_id":"robothector-cvu.2","type":"blocks","created_at":"2026-02-22T00:21:56.216655227+08:00","created_by":"cyrille"},{"issue_id":"robothector-8gv","depends_on_id":"robothector-cvu","type":"parent-child","created_at":"2026-02-22T00:22:05.11834135+08:00","created_by":"cyrille"}]}
{"id":"robothector-cgc","title":"Phase 2: Foundation and Project Structure","description":"Set up codebase for client/server split. Extract reusable modules from monolithic joystick.py. Define communication protocol.","status":"closed","priority":0,"issue_type":"epic","owner":"cyrille.cailac@gmail.com","created_at":"2026-02-18T13:08:57.102028364+08:00","created_by":"cyrille","updated_at":"2026-02-19T12:24:22.488531666+08:00","closed_at":"2026-02-19T12:24:22.488531666+08:00","close_reason":"All subtasks complete: project structure, protocol, motors, sirens, requirements.","labels":["foundation","phase-2"]}
{"id":"robothector-cgc.1","title":"Set up project directory structure","description":"Create directory layout: server/ (__init__.py, main.py stubs), client/ (__init__.py, main.py stubs), docs/. Keep legacy files (joystick.py, webapp/) intact for reference.","status":"closed","priority":0,"issue_type":"chore","owner":"cyrille.cailac@gmail.com","created_at":"2026-02-18T13:08:57.133761187+08:00","created_by":"cyrille","updated_at":"2026-02-19T11:40:05.532413693+08:00","closed_at":"2026-02-19T11:40:05.532413693+08:00","close_reason":"Closed","labels":["chore","structure"],"dependencies":[{"issue_id":"robothector-cgc.1","depends_on_id":"robothector-cgc","type":"parent-child","created_at":"2026-02-18T13:08:57.134832958+08:00","created_by":"cyrille"}]}
{"id":"robothector-cgc.2","title":"Define control protocol (WebSocket + JSON)","description":"Document in docs/protocol.md. Client to Server: {type:'drive', axis_x:float, axis_y:float} at ~20Hz, {type:'mode', mode:'firefighter'|'ambulance'|''}, {type:'ping'}. Server to Client: {type:'state', mission:str, mode:str, connected:bool}, {type:'pong'}, {type:'error', message:str}. Include arcade-to-tank mixing formula: left=throttle+turn, right=throttle-turn.","status":"closed","priority":0,"issue_type":"task","owner":"cyrille.cailac@gmail.com","created_at":"2026-02-18T13:08:57.167615612+08:00","created_by":"cyrille","updated_at":"2026-02-19T11:40:05.565816454+08:00","closed_at":"2026-02-19T11:40:05.565816454+08:00","close_reason":"Closed","labels":["architecture","protocol"],"dependencies":[{"issue_id":"robothector-cgc.2","depends_on_id":"robothector-cgc","type":"parent-child","created_at":"2026-02-18T13:08:57.168624873+08:00","created_by":"cyrille"}]}
{"id":"robothector-cgc.3","title":"Extract motor control module","description":"Extract from joystick.py into server/motors.py. Use verified BCM pin numbers from pinout audit (expected: GPIO 26=IN1, 19=IN2, 13=IN3, 6=IN4). Interface: init(), cleanup(), set_motors(left_speed, right_speed) where speed is -1.0 to 1.0. Include arcade mixing helper: arcade_mix(throttle, turn) -\u003e (left, right). Keep has_pi fallback for off-Pi development. No servo code.","status":"closed","priority":0,"issue_type":"task","owner":"cyrille.cailac@gmail.com","created_at":"2026-02-18T13:08:57.199761822+08:00","created_by":"cyrille","updated_at":"2026-02-19T11:40:05.606101961+08:00","closed_at":"2026-02-19T11:40:05.606101961+08:00","close_reason":"Closed","labels":["motors","refactor"],"dependencies":[{"issue_id":"robothector-cgc.3","depends_on_id":"robothector-cgc","type":"parent-child","created_at":"2026-02-18T13:08:57.200724283+08:00","created_by":"cyrille"},{"issue_id":"robothector-cgc.3","depends_on_id":"robothector-cv2.1","type":"blocks","created_at":"2026-02-18T13:08:57.305199912+08:00","created_by":"cyrille"}]}
{"id":"robothector-cgc.4","title":"Extract siren/audio module","description":"Extract from joystick.py into server/sirens.py. Manages reverse.wav, firefighter.wav, ambulance.wav via pygame.mixer. Interface: init(), play_siren(mode), stop_sirens(), cleanup(). Modes: firefighter, ambulance, reverse, none.","status":"closed","priority":1,"issue_type":"task","owner":"cyrille.cailac@gmail.com","created_at":"2026-02-18T13:08:57.241744326+08:00","created_by":"cyrille","updated_at":"2026-02-19T11:40:05.636979622+08:00","closed_at":"2026-02-19T11:40:05.636979622+08:00","close_reason":"Closed","labels":["audio","refactor"],"dependencies":[{"issue_id":"robothector-cgc.4","depends_on_id":"robothector-cgc","type":"parent-child","created_at":"2026-02-18T13:08:57.242788786+08:00","created_by":"cyrille"},{"issue_id":"robothector-cgc.4","depends_on_id":"robothector-cgc.3","type":"blocks","created_at":"2026-02-18T13:08:57.335931094+08:00","created_by":"cyrille"}]}
{"id":"robothector-cgc.5","title":"Create requirements files","description":"requirements-server.txt: RPi.GPIO, flask, picamera2, websockets, pygame (for audio). requirements-client.txt: pygame, websocket-client, requests. Pin major versions.","status":"closed","priority":1,"issue_type":"chore","owner":"cyrille.cailac@gmail.com","created_at":"2026-02-18T13:08:57.273739556+08:00","created_by":"cyrille","updated_at":"2026-02-19T11:40:05.66707791+08:00","closed_at":"2026-02-19T11:40:05.66707791+08:00","close_reason":"Closed","labels":["chore","dependencies"],"dependencies":[{"issue_id":"robothector-cgc.5","depends_on_id":"robothector-cgc","type":"parent-child","created_at":"2026-02-18T13:08:57.274850627+08:00","created_by":"cyrille"}]}
{"id":"robothector-cv2","title":"Phase 1: Hardware Diagnostics","description":"Verify all hardware over SSH: GPIO/H-bridge motors and camera module. Must confirm pinout before writing server code.","status":"closed","priority":0,"issue_type":"epic","owner":"cyrille.cailac@gmail.com","created_at":"2026-02-18T13:08:56.852106506+08:00","created_by":"cyrille","updated_at":"2026-02-19T12:18:35.249009087+08:00","closed_at":"2026-02-19T12:18:35.249009087+08:00","close_reason":"All subtasks complete: GPIO pinout verified, camera verified, hardware diagnostic script created.","labels":["diagnostics","hardware","phase-1"]}
{"id":"robothector-cv2.1","title":"Verify GPIO pinout over SSH","description":"Three conflicting pin mappings exist. pinout.md (most recent, has wire colors) says BCM GPIO 26/19/13/6. joystick.py uses BOARD 11/13/15/16 (BCM 17/27/22/23). joystick_test.py swaps pins 15/16. SSH in and test GPIO 26/19/13/6 with simple on/off to confirm which pin pair drives which motor and direction. Update pinout.md and CLAUDE.md with verified BCM mapping.","status":"closed","priority":0,"issue_type":"bug","owner":"cyrille.cailac@gmail.com","created_at":"2026-02-18T13:08:56.883669119+08:00","created_by":"cyrille","updated_at":"2026-02-19T11:25:06.006964001+08:00","closed_at":"2026-02-19T11:25:06.006964001+08:00","close_reason":"Closed","labels":["blocking","gpio","hardware"],"dependencies":[{"issue_id":"robothector-cv2.1","depends_on_id":"robothector-cv2","type":"parent-child","created_at":"2026-02-18T13:08:56.88464516+08:00","created_by":"cyrille"},{"issue_id":"robothector-cv2.1","depends_on_id":"robothector-do6.3","type":"blocks","created_at":"2026-02-18T13:08:56.980801923+08:00","created_by":"cyrille"}]}
{"id":"robothector-cv2.2","title":"Diagnose Pi camera module over SSH","description":"SSH in and test: libcamera-hello --list-cameras, libcamera-still -o test.jpg, test Picamera2 Python API. Check ribbon cable, raspi-config camera enable, /boot/config.txt camera_auto_detect=1. Also fix webapp/app.py try/finally syntax error.","status":"closed","priority":0,"issue_type":"task","owner":"cyrille.cailac@gmail.com","created_at":"2026-02-18T13:08:56.915767166+08:00","created_by":"cyrille","updated_at":"2026-02-19T11:25:36.263601727+08:00","closed_at":"2026-02-19T11:25:36.263601727+08:00","close_reason":"Closed","labels":["camera","diagnostics"],"dependencies":[{"issue_id":"robothector-cv2.2","depends_on_id":"robothector-cv2","type":"parent-child","created_at":"2026-02-18T13:08:56.916758387+08:00","created_by":"cyrille"},{"issue_id":"robothector-cv2.2","depends_on_id":"robothector-do6.3","type":"blocks","created_at":"2026-02-18T13:08:57.01081166+08:00","created_by":"cyrille"}]}
{"id":"robothector-cv2.3","title":"Create hardware diagnostic script","description":"Create server/hardware_test.py — run on Pi via SSH to verify all hardware.\n\nTests:\n1. GPIO motor test: import server.motors; motors.init(); for each motor: forward 1s, backward 1s, stop. Print pin states.\n2. Camera test: from picamera2 import Picamera2; capture one frame, verify size \u003e 0.\n3. Report pass/fail per component.\n\nRun: ssh robothector 'cd ~/robothector \u0026\u0026 uv run python -m server.hardware_test'\nReplaces deleted legacy scripts (joystick_test.py, angle.py, angle_pigpio.py).\nUses: server/motors.py (already exists — arcade_mix, set_motors, stop, init/cleanup with BCM pins 26/19/13/6)","status":"closed","priority":1,"issue_type":"task","owner":"cyrille.cailac@gmail.com","created_at":"2026-02-18T13:08:56.949613028+08:00","created_by":"cyrille","updated_at":"2026-02-19T12:16:48.952417778+08:00","closed_at":"2026-02-19T12:16:48.952417778+08:00","close_reason":"Created server/hardware_test.py with motor and camera tests. Imports verified.","labels":["hardware","testing"],"dependencies":[{"issue_id":"robothector-cv2.3","depends_on_id":"robothector-cv2","type":"parent-child","created_at":"2026-02-18T13:08:56.950602339+08:00","created_by":"cyrille"},{"issue_id":"robothector-cv2.3","depends_on_id":"robothector-cv2.1","type":"blocks","created_at":"2026-02-18T13:08:57.040427752+08:00","created_by":"cyrille"},{"issue_id":"robothector-cv2.3","depends_on_id":"robothector-cv2.2","type":"blocks","created_at":"2026-02-18T13:08:57.070627158+08:00","created_by":"cyrille"}]}
{"id":"robothector-cvu","title":"Phase 4: Bidirectional Audio","description":"Two-way audio between Steam Deck/desktop and robot via I2S audio on Pi.\n\nHARDWARE (ordered):\n- Pi mic: INMP441 or ICS43434 I2S MEMS microphone (captures robot environment)\n- Pi speaker: MAX98357A I2S 3W amplifier module (plays operator voice)\n- Client: desktop/Steam Deck built-in mic + speakers\n\nARCHITECTURE:\n- Pi captures I2S mic → streams PCM over UDP:5001 → client plays through speakers\n- Client captures mic → streams PCM over UDP:5002 → Pi plays through MAX98357A\n- Push-to-talk first, full duplex later\n\nGPIO CONFLICT: GPIO 19 is used by both motor IN2 and I2S LRCLK. Must rewire IN2 to a free GPIO before adding audio. See pinout.md.","status":"open","priority":2,"issue_type":"epic","owner":"cyrille.cailac@gmail.com","created_at":"2026-02-18T13:08:58.297755808+08:00","created_by":"cyrille","updated_at":"2026-02-22T00:03:25.966398778+08:00","labels":["audio","phase-4"]}
{"id":"robothector-cvu.1","title":"Research audio stack on Steam Deck and Pi","description":"Now that hardware is chosen (INMP441/ICS43434 I2S mic + MAX98357A I2S amp), research focuses on:\n\n1. I2S kernel overlay: which dtoverlay for INMP441 + MAX98357A simultaneously? Can both share BCLK/LRCLK?\n2. ALSA config: verify capture from I2S mic (arecord) and playback to I2S amp (aplay)\n3. Python audio library: sounddevice (uses PortAudio/ALSA) vs pyaudio — which handles I2S devices better?\n4. Client side: PyAudio/sounddevice for desktop mic capture + speaker playback\n5. Transport: UDP raw PCM (16-bit mono 16kHz = 32KB/s) vs Opus compression\n6. Latency budget: target \u003c300ms one-way for usable voice\n7. GPIO 19 conflict: IN2 must move to a free pin (e.g. GPIO 12 or 16) before I2S can be enabled\n\nI2S PIN MAPPING (from pinout.md):\n  GPIO 18 (pin 12) = PCM_CLK / BCLK (shared)\n  GPIO 19 (pin 35) = PCM_FS / LRCLK (shared) ← CONFLICTS with motor IN2\n  GPIO 20 (pin 38) = PCM_DIN (mic data)\n  GPIO 21 (pin 40) = PCM_DOUT (speaker data)\n\nOUTPUT: docs/audio-design.md with dtoverlay config, wiring diagram, library choice, protocol.","status":"closed","priority":2,"issue_type":"task","owner":"cyrille.cailac@gmail.com","created_at":"2026-02-18T13:08:58.329754471+08:00","created_by":"cyrille","updated_at":"2026-02-22T00:19:39.709474926+08:00","closed_at":"2026-02-22T00:19:39.709474926+08:00","close_reason":"Created docs/audio-design.md with full I2S overlay config, ALSA setup, sounddevice library choice, raw PCM over UDP transport, latency budget (~80-125ms), and GPIO 17 as IN2 replacement pin","labels":["audio","research"],"dependencies":[{"issue_id":"robothector-cvu.1","depends_on_id":"robothector-cvu","type":"parent-child","created_at":"2026-02-18T13:08:58.330962481+08:00","created_by":"cyrille"}]}
{"id":"robothector-cvu.2","title":"Implement Pi-to-client audio stream","description":"Create server/audio.py — capture I2S mic and stream to client over UDP.\n\nAUDIO FORMAT (from research):\n- Raw PCM: 16-bit signed LE, mono, 16kHz\n- Chunk: 640 samples = 40ms = 1280 bytes\n- Packet: [seq:uint16][audio:1280 bytes] = 1282 bytes total\n- Bandwidth: ~32 KB/s\n- Port: UDP 5556 (Pi → Client)\n\nIMPLEMENTATION:\n- Use sounddevice library (InputStream with callback)\n- Install on Pi: sudo apt-get install -y libportaudio2 \u0026\u0026 uv pip install sounddevice numpy\n- INMP441 outputs S32_LE at 48kHz — downsample to 16kHz int16 in callback\n- Get client IP from active WebSocket connection in server/control.py\n- Background thread for capture loop\n- Sequence number (uint16, wrapping) for loss detection on client side\n\nCLASS: AudioCapture\n- __init__(self, client_addr: str, port: int = 5556)\n- start() — open sounddevice InputStream, start UDP socket\n- stop() — close stream, close socket\n- Properties: is_running, packets_sent\n\nINTEGRATION with server/main.py:\n- Start AudioCapture when client connects (or on audio_start message)\n- Stop when client disconnects or audio_stop message\n- Add --no-audio flag similar to --no-camera\n\nLATENCY NOTE:\n- Use blocksize=640, latency='low' for ~40ms capture latency\n- Total one-way budget: ~80-125ms (well within 300ms target)\n\nFALLBACK: If sounddevice has I2S issues, try pyalsaaudio (direct ALSA, no PortAudio).","status":"open","priority":2,"issue_type":"task","owner":"cyrille.cailac@gmail.com","created_at":"2026-02-18T13:08:58.36229488+08:00","created_by":"cyrille","updated_at":"2026-02-22T00:20:48.364714358+08:00","labels":["audio","server","streaming"],"dependencies":[{"issue_id":"robothector-cvu.2","depends_on_id":"robothector-cvu","type":"parent-child","created_at":"2026-02-18T13:08:58.363286012+08:00","created_by":"cyrille"},{"issue_id":"robothector-cvu.2","depends_on_id":"robothector-cvu.1","type":"blocks","created_at":"2026-02-18T13:08:58.493379567+08:00","created_by":"cyrille"},{"issue_id":"robothector-cvu.2","depends_on_id":"robothector-cvu.5","type":"blocks","created_at":"2026-02-22T00:04:21.105154339+08:00","created_by":"cyrille"}]}
{"id":"robothector-cvu.3","title":"Implement client-to-Pi audio stream","description":"Create client/audio.py — handle both directions of audio on client side.\n\nAUDIO FORMAT (from research):\n- Raw PCM: 16-bit signed LE, mono, 16kHz\n- Chunk: 640 samples = 40ms = 1280 bytes\n- Packet: [seq:uint16][audio:1280 bytes] = 1282 bytes total\n\nCLIENT RECEIVES Pi mic audio (robot environment):\n- Listen on UDP 5556\n- Jitter buffer: deque(maxlen=5) ≈ 200ms max\n- sounddevice OutputStream callback pops from buffer, fills silence if empty\n- Plays continuously (always-on robot environment audio)\n\nCLIENT SENDS mic audio (operator voice):\n- Capture local mic via sounddevice InputStream\n- Send UDP to Pi on port 5557\n- Push-to-talk: only capture+send while PTT active\n- PTT state set by joystick.py (bool flag)\n\nCLASSES:\n- AudioReceiver: UDP listener → jitter buffer → OutputStream playback\n  - __init__(self, listen_port=5556)\n  - start()/stop(), property: is_running, level (for UI meter)\n- AudioSender: InputStream capture → UDP sender\n  - __init__(self, server_addr: str, port=5557)\n  - start()/stop(), set_transmitting(bool), property: is_running, level\n\nINSTALL: uv pip install sounddevice numpy\n\nSTEAM DECK NOTE:\n- PipeWire's ALSA compatibility works with sounddevice automatically\n- If sd.query_devices() returns empty: ensure pipewire-alsa is installed\n- No special code changes needed vs desktop Linux","status":"open","priority":2,"issue_type":"task","owner":"cyrille.cailac@gmail.com","created_at":"2026-02-18T13:08:58.395254075+08:00","created_by":"cyrille","updated_at":"2026-02-22T00:20:56.703806028+08:00","labels":["audio","client","streaming"],"dependencies":[{"issue_id":"robothector-cvu.3","depends_on_id":"robothector-cvu","type":"parent-child","created_at":"2026-02-18T13:08:58.396382046+08:00","created_by":"cyrille"},{"issue_id":"robothector-cvu.3","depends_on_id":"robothector-cvu.1","type":"blocks","created_at":"2026-02-18T13:08:58.524971874+08:00","created_by":"cyrille"},{"issue_id":"robothector-cvu.3","depends_on_id":"robothector-cvu.5","type":"blocks","created_at":"2026-02-22T00:04:21.143223202+08:00","created_by":"cyrille"}]}
{"id":"robothector-cvu.4","title":"Add audio controls to client UI","description":"Add audio controls to client/ui.py and integrate in client/main.py.\n\nUI ELEMENTS (in HUD overlay):\n- PTT indicator: show 'MIC TX' when transmitting (PTT button held)\n- Audio status: 'AUDIO' when receiving robot audio, dim when silent\n- Optional: simple level bars for mic input + speaker output\n\nBUTTON MAPPING (in client/joystick.py):\n- PTT: right bumper (R1) — hold to transmit\n- Mute toggle: D-pad down — mute/unmute incoming robot audio\n\nMAIN LOOP CHANGES (client/main.py):\n- Init AudioReceiver and AudioSender alongside existing components\n- On WebSocket connect: send {\"type\": \"audio_start\"} to server\n- On WebSocket disconnect: stop audio streams\n- Each frame: pass PTT button state → AudioSender.set_transmitting(bool)\n- Cleanup: audio_sender.stop(), audio_receiver.stop()\n\nWEBSOCKET MESSAGES (add to docs/protocol.md):\n- {\"type\": \"audio_start\"} — client requests Pi to start streaming mic audio\n- {\"type\": \"audio_stop\"} — client requests Pi to stop audio\n- {\"type\": \"ptt\", \"active\": true/false} — push-to-talk state (informational)\n\nDEPENDS ON: client/audio.py classes from cvu.2 and cvu.3","status":"open","priority":2,"issue_type":"task","owner":"cyrille.cailac@gmail.com","created_at":"2026-02-18T13:08:58.428533468+08:00","created_by":"cyrille","updated_at":"2026-02-22T00:21:03.04656333+08:00","labels":["audio","client","ui"],"dependencies":[{"issue_id":"robothector-cvu.4","depends_on_id":"robothector-cvu","type":"parent-child","created_at":"2026-02-18T13:08:58.429645308+08:00","created_by":"cyrille"},{"issue_id":"robothector-cvu.4","depends_on_id":"robothector-cvu.2","type":"blocks","created_at":"2026-02-18T13:08:58.554917346+08:00","created_by":"cyrille"},{"issue_id":"robothector-cvu.4","depends_on_id":"robothector-cvu.3","type":"blocks","created_at":"2026-02-18T13:08:58.586377204+08:00","created_by":"cyrille"},{"issue_id":"robothector-cvu.4","depends_on_id":"robothector-zia","type":"blocks","created_at":"2026-02-22T00:21:55.752213433+08:00","created_by":"cyrille"}]}
{"id":"robothector-cvu.5","title":"Wire I2S audio modules and resolve GPIO 19 conflict","description":"Physical wiring and Pi configuration for I2S audio.\n\nPART A — GPIO 19 CONFLICT (software, can do without hardware):\n1. Update server/motors.py: change IN2 = 19 → IN2 = 17 (GPIO 17, pin 11)\n2. Update pinout.md: motor wiring table + GPIO header diagram\n3. Update CLAUDE.md pinout table\n\nWHY GPIO 17:\n- General purpose, no alternate function conflicts\n- Not used by I2S (18/19/20/21), SPI (7-11), I2C (2-3), UART (14-15)\n- GPIO 16 was first candidate but googlevoicehat-soundcard overlay claims it for SD_MODE\n- GPIO 12 reserved for future PWM speed control (ENA)\n\nPART B — PHYSICAL REWIRE (requires hands-on):\n4. Move black wire from pin 35 (GPIO 19) to pin 11 (GPIO 17)\n5. Run motor_test.py to verify motors still work\n\nPART C — I2S WIRING (requires hardware modules):\n6. Wire INMP441 I2S mic:\n   - VDD → 3.3V (pin 1), GND → GND (pin 6/14)\n   - SCK → GPIO 18 (pin 12) BCLK\n   - WS → GPIO 19 (pin 35) LRCLK\n   - SD → GPIO 20 (pin 38) DIN\n   - L/R → GND (left channel)\n7. Wire MAX98357A I2S amp:\n   - VIN → 5V (pin 2), GND → GND\n   - BCLK → GPIO 18 (pin 12)\n   - LRCLK → GPIO 19 (pin 35)\n   - DIN → GPIO 21 (pin 40) DOUT\n   - SD_MODE → tie to 3.3V (always on)\n\nPART D — PI CONFIG (requires SSH to Pi):\n8. Edit /boot/firmware/config.txt:\n   - Comment out: #dtparam=audio=on\n   - Add: dtparam=i2s=on\n   - Add: dtoverlay=googlevoicehat-soundcard\n   - Add: dtoverlay=i2s-mmap\n   - Do NOT add dtoverlay=max98357a (conflicts)\n9. Create /etc/asound.conf with dmix/dsnoop/asym config (see docs/audio-design.md)\n10. Reboot Pi\n11. Verify: aplay -l and arecord -l both show I2S card\n12. Test mic: arecord -D plughw:0 -c1 -r 48000 -f S32_LE -t wav -d 5 test.wav\n13. Test speaker: speaker-test -c 2 -D plughw:0,0 -t sine\n\nFALLBACK: If googlevoicehat-soundcard overlay fails, compile custom i2s-duplex overlay (see docs/audio-design.md).\n\nWARNING: Stop pigpiod if running — conflicts with I2S PCM clock.","status":"open","priority":1,"issue_type":"task","owner":"cyrille.cailac@gmail.com","created_at":"2026-02-22T00:03:50.026480677+08:00","created_by":"cyrille","updated_at":"2026-02-22T00:20:38.269294163+08:00","labels":["audio","hardware","i2s"],"dependencies":[{"issue_id":"robothector-cvu.5","depends_on_id":"robothector-cvu","type":"parent-child","created_at":"2026-02-22T00:03:50.027627244+08:00","created_by":"cyrille"},{"issue_id":"robothector-cvu.5","depends_on_id":"robothector-cvu.1","type":"blocks","created_at":"2026-02-22T00:04:21.179402313+08:00","created_by":"cyrille"}]}
{"id":"robothector-do6","title":"Phase 0: SSH and Network Discovery","description":"First priority: establish SSH access to Pi inside the robot. Auto-detect Pi on LAN via mDNS. Foundation for all subsequent work.","status":"closed","priority":0,"issue_type":"epic","owner":"cyrille.cailac@gmail.com","created_at":"2026-02-18T13:08:56.504810225+08:00","created_by":"cyrille","updated_at":"2026-02-19T12:18:35.211049152+08:00","closed_at":"2026-02-19T12:18:35.211049152+08:00","close_reason":"All subtasks complete: SSH, mDNS, UDP beacon, connection test.","labels":["networking","phase-0"]}
{"id":"robothector-do6.1","title":"Research Steam Deck network environment","description":"Document SteamOS constraints: mDNS/Avahi availability, flatpak package limits, network interfaces, SSH client availability, gaming mode restrictions. Output: docs/steamdeck-env.md.","status":"closed","priority":0,"issue_type":"task","owner":"cyrille.cailac@gmail.com","created_at":"2026-02-18T13:08:56.535617253+08:00","created_by":"cyrille","updated_at":"2026-02-19T11:24:24.373400137+08:00","closed_at":"2026-02-19T11:24:24.373400137+08:00","close_reason":"Closed","labels":["research","steamdeck"],"dependencies":[{"issue_id":"robothector-do6.1","depends_on_id":"robothector-do6","type":"parent-child","created_at":"2026-02-18T13:08:56.536568145+08:00","created_by":"cyrille"}]}
{"id":"robothector-do6.2","title":"Configure mDNS/Avahi hostname broadcast on Pi","description":"Install and configure avahi-daemon on Pi. Broadcast as robothector.local. Verify: ping robothector.local resolves from any LAN machine.","status":"closed","priority":0,"issue_type":"task","owner":"cyrille.cailac@gmail.com","created_at":"2026-02-18T13:08:56.569141108+08:00","created_by":"cyrille","updated_at":"2026-02-19T11:24:24.405083571+08:00","closed_at":"2026-02-19T11:24:24.405083571+08:00","close_reason":"Closed","labels":["mdns","networking","pi"],"dependencies":[{"issue_id":"robothector-do6.2","depends_on_id":"robothector-do6","type":"parent-child","created_at":"2026-02-18T13:08:56.570243629+08:00","created_by":"cyrille"},{"issue_id":"robothector-do6.2","depends_on_id":"robothector-do6.1","type":"blocks","created_at":"2026-02-18T13:08:56.698907956+08:00","created_by":"cyrille"}]}
{"id":"robothector-do6.3","title":"Configure SSH key-based auth from Steam Deck to Pi","description":"Generate SSH keypair on Steam Deck (if not exists). Copy public key to Pi authorized_keys. Test: ssh pi@robothector.local works without password. Document steps in docs/setup-ssh.md.","status":"closed","priority":0,"issue_type":"task","owner":"cyrille.cailac@gmail.com","created_at":"2026-02-18T13:08:56.601521573+08:00","created_by":"cyrille","updated_at":"2026-02-19T11:24:24.43967751+08:00","closed_at":"2026-02-19T11:24:24.43967751+08:00","close_reason":"Closed","labels":["security","ssh"],"dependencies":[{"issue_id":"robothector-do6.3","depends_on_id":"robothector-do6","type":"parent-child","created_at":"2026-02-18T13:08:56.602589984+08:00","created_by":"cyrille"},{"issue_id":"robothector-do6.3","depends_on_id":"robothector-do6.2","type":"blocks","created_at":"2026-02-18T13:08:56.731006213+08:00","created_by":"cyrille"}]}
{"id":"robothector-do6.4","title":"Implement UDP beacon discovery fallback","description":"Create server/discovery.py and client/discovery.py for UDP beacon auto-discovery.\n\nSERVER (server/discovery.py):\n- Broadcast UDP beacon on port 5555 every 2s on the LAN broadcast address\n- JSON payload: {\"name\": \"robothector\", \"ip\": \"\u003clocal_ip\u003e\", \"ws_port\": 8765, \"video_port\": 5000}\n- Use socket.SO_BROADCAST, send to 255.255.255.255:5555\n- Run as a background thread, started from server/main.py\n\nCLIENT (client/discovery.py):\n- Listen on UDP port 5555 for beacon packets\n- Return first valid beacon as (ip, ws_port, video_port) tuple\n- Timeout after 5s if no beacon found\n- Used by client/network.py as fallback when robothector.local doesn't resolve\n\nWHY: mDNS is unreliable on Steam Deck (see docs/steamdeck-env.md). This is the primary discovery mechanism.\n\nDeps installed: socket (stdlib), json (stdlib) — no extra packages needed.","status":"closed","priority":1,"issue_type":"task","owner":"cyrille.cailac@gmail.com","created_at":"2026-02-18T13:08:56.634016737+08:00","created_by":"cyrille","updated_at":"2026-02-19T12:16:48.913724901+08:00","closed_at":"2026-02-19T12:16:48.913724901+08:00","close_reason":"Implemented server/discovery.py (beacon broadcaster) and client/discovery.py (beacon listener). E2E tested locally.","labels":["discovery","networking"],"dependencies":[{"issue_id":"robothector-do6.4","depends_on_id":"robothector-do6","type":"parent-child","created_at":"2026-02-18T13:08:56.635091887+08:00","created_by":"cyrille"},{"issue_id":"robothector-do6.4","depends_on_id":"robothector-do6.2","type":"blocks","created_at":"2026-02-18T13:08:56.761619853+08:00","created_by":"cyrille"}]}
{"id":"robothector-do6.5","title":"Create connection test script","description":"Create client/test_connection.py — a standalone script to verify all connectivity before a driving session.\n\nTests to run (in order):\n1. mDNS: try socket.getaddrinfo('robothector.local', None) — expect 192.168.50.169\n2. UDP beacon: import client.discovery, listen for 5s — expect beacon with IP\n3. SSH: subprocess.run(['ssh', '-o', 'ConnectTimeout=3', 'robothector', 'echo ok'])\n4. HTTP video: urllib.request.urlopen('http://\u003cip\u003e:5000/health', timeout=3)\n5. WebSocket: websocket.create_connection('ws://\u003cip\u003e:8765', timeout=3)\n\nOutput: pass/fail per test with latency in ms. Exit 0 if all critical tests pass, exit 1 otherwise.\n\nRun: uv run python -m client.test_connection\nDeps: websocket-client (installed in .venv)","status":"closed","priority":1,"issue_type":"task","owner":"cyrille.cailac@gmail.com","created_at":"2026-02-18T13:08:56.666923587+08:00","created_by":"cyrille","updated_at":"2026-02-19T12:17:18.919155876+08:00","closed_at":"2026-02-19T12:17:18.919155876+08:00","close_reason":"Created client/test_connection.py with mDNS, UDP beacon, SSH, HTTP video, and WebSocket tests.","labels":["networking","testing"],"dependencies":[{"issue_id":"robothector-do6.5","depends_on_id":"robothector-do6","type":"parent-child","created_at":"2026-02-18T13:08:56.667934978+08:00","created_by":"cyrille"},{"issue_id":"robothector-do6.5","depends_on_id":"robothector-do6.3","type":"blocks","created_at":"2026-02-18T13:08:56.791316672+08:00","created_by":"cyrille"},{"issue_id":"robothector-do6.5","depends_on_id":"robothector-do6.4","type":"blocks","created_at":"2026-02-18T13:08:56.820378796+08:00","created_by":"cyrille"}]}
{"id":"robothector-qam","title":"Add sounddevice + numpy to Pi dependencies","description":"Install audio Python dependencies on Pi and add to project requirements.\n\nON PI (via SSH):\n  sudo apt-get install -y libportaudio2\n  uv pip install sounddevice numpy\n\nON DESKTOP/CLIENT:\n  uv pip install sounddevice numpy\n\nAdd to pyproject.toml or requirements if one exists. sounddevice is the chosen library (over pyaudio) per audio-design.md research.\n\nFallback: pyalsaaudio (sudo apt-get install -y libasound2-dev \u0026\u0026 uv pip install pyalsaaudio) if sounddevice has I2S issues.","status":"open","priority":1,"issue_type":"task","owner":"cyrille.cailac@gmail.com","created_at":"2026-02-22T00:21:10.505201614+08:00","created_by":"cyrille","updated_at":"2026-02-22T00:21:10.505201614+08:00","labels":["audio","robothector-8gv"],"dependencies":[{"issue_id":"robothector-qam","depends_on_id":"robothector-cvu.5","type":"blocks","created_at":"2026-02-22T00:21:54.531635847+08:00","created_by":"cyrille"},{"issue_id":"robothector-qam","depends_on_id":"robothector-cvu","type":"parent-child","created_at":"2026-02-22T00:22:05.047223574+08:00","created_by":"cyrille"}]}
{"id":"robothector-zia","title":"Add Pi audio receiver and playback (client→Pi direction)","description":"Add UDP receiver + I2S playback to server/audio.py for the client→Pi direction.\n\nThis is the second half of server/audio.py — receiving operator voice from the client and playing it through the MAX98357A amp.\n\nIMPLEMENTATION:\n- Listen on UDP 5557 for incoming PCM from client\n- Jitter buffer: deque(maxlen=5)\n- sounddevice OutputStream callback pops from buffer\n- Same format: 16-bit signed LE, mono, 16kHz, 640 sample chunks\n- Only active when client is transmitting (PTT)\n\nCLASS: AudioPlayback\n- __init__(self, listen_port=5557)\n- start()/stop()\n- is_running property\n\nINTEGRATION: Start/stop alongside AudioCapture in server/main.py.\n\nDepends on cvu.5 (I2S wiring) and cvu.2 (server/audio.py file creation).","status":"open","priority":2,"issue_type":"task","owner":"cyrille.cailac@gmail.com","created_at":"2026-02-22T00:21:15.42313328+08:00","created_by":"cyrille","updated_at":"2026-02-22T00:21:15.42313328+08:00","labels":["audio","robothector-8gv"],"dependencies":[{"issue_id":"robothector-zia","depends_on_id":"robothector-cvu.2","type":"blocks","created_at":"2026-02-22T00:21:55.2036312+08:00","created_by":"cyrille"},{"issue_id":"robothector-zia","depends_on_id":"robothector-cvu.5","type":"blocks","created_at":"2026-02-22T00:21:55.241717092+08:00","created_by":"cyrille"},{"issue_id":"robothector-zia","depends_on_id":"robothector-cvu","type":"parent-child","created_at":"2026-02-22T00:22:05.083580798+08:00","created_by":"cyrille"}]}
